import{j as e,A as Z,C as je,u as K,r as m,D as u,a as g,d as G,B as b,T as i,g as ge,b as fe,c as pe,e as ve,f as X,h as I,i as de,k as Se,l as ce,m as me,n as xe,o as be,L as $,p as ie,q as Te,s as ye,t as N,v as J,w as r,x as re,y as we,I as he,z as Ce,E as ne,F as Ae,G as ue,S,H as ke,J as C,K as Ie,M as Oe,N as Be,O as ze,P as Fe,R as Me,Q as Re,U as De,V as Pe,W as Le,X as Ee,Y as q,Z as We,_ as $e,$ as Ne,a0 as Ue,a1 as He,a2 as _e,a3 as Ve,a4 as ae,a5 as Ge,a6 as qe,a7 as Qe,a8 as Ke,a9 as Xe,aa as Ze}from"./index-b40a3c2f.js";function Y({status:s}){return s?Z[s]?e.jsx(je,{size:"small",label:s,sx:{borderRadius:"4px",border:"none",fontWeight:700,fontSize:"12px",textTransform:"uppercase",background:Z[s].background.primary,color:Z[s].color.primary},variant:"outlined"}):e.jsx("span",{children:"todo2"}):e.jsx("span",{children:"todo1"})}const Je=s=>{const{history:o,currentStatus:a}=s,l=K(),[d,c]=m.useState(!1),j=()=>{c(!1)},f=()=>{c(!0)},h=new Date().toISOString(),p=u.fromISO(h),x=u.fromISO(o[0].start),T=a===g.complete?G(u.fromISO(o.at(-1).end),u.fromISO(o[0].start)):G(p,x);return e.jsxs(b,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(i,{children:[g.ready,g.complete].includes(g[a])?e.jsxs(e.Fragment,{children:[ge(o),"m"]}):e.jsxs(e.Fragment,{children:[G(u.fromISO(o.at(-1).end||h),u.fromISO(o.at(-1).start)),"m / ",T,"m"]})}),e.jsx(fe,{onClickAway:j,children:e.jsx("div",{children:e.jsx(pe,{PopperProps:{disablePortal:!0},onClose:j,open:d,disableFocusListener:!0,disableHoverListener:!0,disableTouchListener:!0,title:e.jsxs(b,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:[o.map((v,y)=>e.jsxs(b,{sx:{display:"flex",gap:1},children:[e.jsxs(i,{sx:{minWidth:"60px"},children:[G(u.fromISO(v.end||h),u.fromISO(v.start))," ","mins"]}),e.jsx(Y,{status:v.status})]},"".concat(v.status,"-").concat(y))),e.jsxs(i,{sx:{fontWeight:700,mt:1},children:["Total: ",T," mins"]})]}),children:e.jsx(b,{sx:{display:"flex",alignItems:"center"},children:e.jsx(ve,{onClick:f,fontSize:"small",sx:{color:l.palette.text.secondary,cursor:"pointer"}})})})})})]})},Ye=({appointment:s})=>{const[o,a]=m.useState(""),{availableStates:l}=X(I,["availableStates"]),d=de(),c=!!(d!=null&&d.profileResource)&&Se(s.encounter,d.profileResource);return m.useEffect(()=>{!s.location.state||!l.includes(s.location.state)||[g.complete,g.unsigned].includes(s.telemedStatus)||[g["pre-video"],g["on-video"]].includes(s.telemedStatus)&&!c?s.telemedStatus===g.unsigned&&s.location.state&&l.includes(s.location.state)&&c?a("viewContained"):a("viewOutlined"):s.telemedStatus===g.ready?a("assignMe"):s.telemedStatus===g["pre-video"]?a("unassign"):s.telemedStatus===g["on-video"]?a("reconnect"):a("")},[s.location.state,l,s.telemedStatus,c]),{type:o}},Q={borderRadius:8,textTransform:"none",fontSize:"15px",fontWeight:"700"},es=s=>{const{appointment:o}=s,a=ce(),l=me(),d=xe(),c=be(),j=x=>{d("/telemed/appointments/".concat(o.id),{state:x})},f=async(x,T)=>{if(!a)throw new Error("api client not defined");await l.mutateAsync({apiClient:a,appointmentId:o.id,newStatus:x},{}),T&&await c.invalidateQueries({queryKey:["telemed-appointments"]})},h=async x=>{await f(x),j()},{type:p}=Ye({appointment:o});switch(p){case"viewContained":case"viewOutlined":return e.jsx($,{onClick:()=>j(),variant:p==="viewContained"?"contained":"outlined",sx:Q,children:"View"});case"assignMe":return e.jsx(ie,{title:"Do you want to assign this appointment?",response:()=>h(g["pre-video"]),actionButtons:{proceed:{text:"Assign to me"},back:{text:"Cancel"}},children:x=>e.jsx($,{onClick:x,loading:l.isLoading,variant:"contained",sx:Q,children:"Assign me"})});case"unassign":return e.jsx(ie,{title:"Do you want to unassign this appointment?",response:()=>f(g.ready,!0),actionButtons:{proceed:{text:"Unassign",color:"error"},back:{text:"Cancel"}},children:x=>e.jsx($,{onClick:x,loading:l.isLoading,color:"error",variant:"outlined",sx:Q,children:"Unassign"})});case"reconnect":return e.jsx($,{onClick:()=>j({reconnect:!0}),loading:l.isLoading,variant:"contained",sx:Q,children:"Reconnect"});default:return null}};function oe({appointment:s,showEstimated:o,showProvider:a,next:l}){var O,B,t,n,U,ee;const d=K(),c=xe(),[j,f]=m.useState(!1),[h,p]=m.useState(((O=s.smsModel)==null?void 0:O.hasUnreadMessages)||!1),x="".concat(s.patient.lastName,", ").concat(s.patient.firstName)||"Unknown",T=s.smsModel!==void 0,v=m.useMemo(()=>{var F,M,R,D,P,L,E,k,se,te;const A=Te((F=s.patient)==null?void 0:F.dateOfBirth),z=ye((M=s.patient)==null?void 0:M.dateOfBirth),H=(L=(P=(D=(R=s==null?void 0:s.paperwork)==null?void 0:R.item)==null?void 0:D.find(W=>W.linkId==="patient-birth-sex"))==null?void 0:P.answer)==null?void 0:L[0].valueString,_=(te=(se=(k=(E=s==null?void 0:s.paperwork)==null?void 0:E.item)==null?void 0:k.find(W=>W.linkId==="guardian-number"))==null?void 0:se.answer)==null?void 0:te[0].valueString,V=A&&z&&"".concat(A," ").concat(z);return[H,V,_].filter(W=>!!W).join(" | ")},[(B=s==null?void 0:s.paperwork)==null?void 0:B.item,(t=s.patient)==null?void 0:t.dateOfBirth]),y=m.useMemo(()=>{var H,_,V,F,M,R,D,P,L,E;const A=(R=(M=(F=(V=(_=(H=s==null?void 0:s.paperwork)==null?void 0:H.item)==null?void 0:_.find(k=>k.linkId==="reason-for-visit"))==null?void 0:V.answer)==null?void 0:F[0].valueString)==null?void 0:M.split(","))==null?void 0:R.join(", "),z=(E=(L=(P=(D=s==null?void 0:s.paperwork)==null?void 0:D.item)==null?void 0:P.find(k=>k.linkId==="additional-information"))==null?void 0:L.answer)==null?void 0:E[0].valueString;return A?z?"".concat(A," (").concat(z,")"):A:""},[(n=s==null?void 0:s.paperwork)==null?void 0:n.item]),w=()=>{c("/telemed/appointments/".concat(s.id))};return e.jsxs(N,{sx:{"&:last-child td, &:last-child th":{border:0},"&:hover":{backgroundColor:J.apptHover},position:"relative",...l&&{boxShadow:"inset 0 0 0 1px ".concat(J.orange800)}},children:[e.jsxs(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:[l&&e.jsx(b,{sx:{backgroundColor:J.orange800,position:"absolute",width:"14px",bottom:0,left:"-14px",height:"100%",borderTopLeftRadius:"10px",borderBottomLeftRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(i,{variant:"subtitle2",fontSize:10,sx:{writingMode:"vertical-lr",transform:"scale(-1)",color:d.palette.common.white},children:"NEXT"})}),e.jsx(Y,{status:s.telemedStatus}),e.jsx(re,{title:s.id,children:e.jsxs(i,{variant:"body2",sx:{color:d.palette.text.secondary,textOverflow:"ellipsis",width:"80px",whiteSpace:"nowrap",overflow:"hidden",pt:"6px"},children:["ID: ",s.id]})})]}),e.jsx(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:e.jsx(i,{children:u.fromISO(s.start||"").toLocaleString(u.DATETIME_SHORT)})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(Je,{history:s.telemedStatusHistory,currentStatus:s.telemedStatus})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(i,{children:(U=s.provider)==null?void 0:U.join(", ")})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(i,{children:(ee=s.group)==null?void 0:ee.join(", ")})}),o&&e.jsx(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:e.jsx(i,{children:s.estimated?we.fromMillis(s.estimated).toFormat("mm'm'"):"...m"})}),e.jsxs(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:[e.jsx(i,{variant:"subtitle2",sx:{fontSize:"16px"},children:x}),e.jsx(i,{variant:"body2",sx:{color:d.palette.text.secondary},children:v})]}),e.jsx(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:e.jsx(i,{sx:{fontSize:"16px"},children:s.location.state})}),e.jsx(r,{sx:{verticalAlign:"top",cursor:"pointer"},onClick:w,children:e.jsx(re,{title:y,children:e.jsx(i,{variant:"body2",sx:{fontSize:"16px",textOverflow:"ellipsis",width:"160px",whiteSpace:"nowrap",overflow:"hidden"},children:y})})}),a&&e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(b,{children:"Dr. Smith"})}),e.jsx(r,{sx:{verticalAlign:"top"},children:T&&e.jsx(he,{color:"primary",sx:{backgroundColor:d.palette.primary.main,width:"36px",height:"36px",borderRadius:"100%",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{backgroundColor:d.palette.primary.dark}},onClick:A=>{f(!0)},"aria-label":h?"unread messages chat icon":"chat icon, no unread messages",children:h?e.jsx(Ce,{variant:"dot",color:"warning",sx:{"& .MuiBadge-badge":{width:"14px",height:"14px",borderRadius:"10px",border:"2px solid white",top:"-4px",right:"-4px"}},children:e.jsx(ne,{sx:{color:d.palette.primary.contrastText,height:"20px",width:"20px"}})}):e.jsx(ne,{sx:{color:d.palette.primary.contrastText,height:"20px",width:"20px"}})})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(es,{appointment:s})}),j&&e.jsx(Ae,{appointment:s,onClose:()=>f(!1),onMarkAllRead:()=>p(!1)})]})}const ss=({showEstimated:s,showProvider:o,isState:a})=>{const l=K();return e.jsxs(e.Fragment,{children:[!a&&e.jsx(N,{children:e.jsx(r,{sx:{backgroundColor:ue(l.palette.secondary.main,.08)},colSpan:7+ +s+ +o,children:e.jsx(b,{sx:{display:"flex",alignItems:"center"},children:e.jsx(S,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"ST - State name"})})})})}),[...Array(3)].map((d,c)=>e.jsxs(N,{sx:{},children:[e.jsxs(r,{children:[e.jsx(S,{variant:"rounded",children:e.jsx(Y,{status:g.ready})}),e.jsx(S,{width:"100%",children:e.jsx(i,{variant:"body2",sx:{pt:"6px"},children:"ID: some ID"})})]}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{width:"100%",children:e.jsx(i,{children:"time"})})}),s&&e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{width:"100%",children:e.jsx(i,{children:"time"})})}),e.jsxs(r,{sx:{verticalAlign:"top"},children:[e.jsx(S,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"16px"},children:"Patient name"})}),e.jsx(S,{width:"100%",children:e.jsx(i,{variant:"body2",children:"Lots of patient info"})})]}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{children:e.jsx(i,{sx:{fontSize:"16px"},children:"ST"})})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{width:"100%",children:e.jsx(i,{sx:{fontSize:"16px"},children:"Reason for visit"})})}),o&&e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{width:"100%",children:e.jsx(i,{children:"Dr. Name"})})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{variant:"circular",children:e.jsx(he,{sx:{width:"36px",height:"36px"}})})}),e.jsx(r,{sx:{verticalAlign:"top"},children:e.jsx(S,{variant:"rounded",children:e.jsx($,{variant:"contained",sx:{fontSize:"15px",fontWeight:"700"},children:"text"})})})]},c))]})};function ts({tab:s}){var O,B;const o=K(),{appointments:a,state:l,availableStates:d,isAppointmentsLoading:c,unsignedFor:j}=X(I,["appointments","state","unsignedFor","availableStates","isAppointmentsLoading"]),f=ke(a,j,s),h=s===C.ready,p=s!==C.ready,x=m.useMemo(()=>l?{}:f.reduce((t,n)=>{if(n.location.locationID)return t[n.location.locationID]||(t[n.location.locationID]=[]),t[n.location.locationID].push(n),t;if(n.provider)return t[n.provider.join(",")]||(t[n.provider.join(",")]=[]),t[n.provider.join(",")].push(n),t;if(n.group)return t[n.group.join(",")]||(t[n.group.join(",")]=[]),t[n.group.join(",")].push(n),t;throw Error("missing location and provider and group")},{}),[f,l]),T=Object.keys(x).reduce((t,n)=>(t[n]=!1,t),{}),v=(t,n)=>t.toMillis()-n.toMillis(),y=(B=(O=f.filter(t=>d.includes(t.location.state)).sort((t,n)=>v(u.fromISO(t.start),u.fromISO(n.start))))==null?void 0:O[0])==null?void 0:B.id,w=s===C.ready;return e.jsxs(b,{children:[e.jsx(Ie,{tab:s}),e.jsx(Oe,{sx:{overflow:"inherit"},children:e.jsxs(Be,{children:[e.jsx(ze,{children:e.jsxs(N,{children:[e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Status"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Start time"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Waiting time"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Provider"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Group"})}),h&&e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Estimated"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Patient"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"State"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Reason"})}),p&&e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Provider"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Chat"})}),e.jsx(r,{children:e.jsx(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:"Action"})})]})}),e.jsx(Fe,{children:c?e.jsx(ss,{showEstimated:h,showProvider:p,isState:!!l}):l?f.sort((t,n)=>v(u.fromISO(t.start),u.fromISO(n.start))).map(t=>e.jsx(oe,{appointment:t,showEstimated:h,showProvider:p,next:t.id===y&&w},t.id)):Object.keys(x).map(t=>e.jsxs(Me.Fragment,{children:[e.jsx(N,{children:e.jsx(r,{sx:{backgroundColor:ue(o.palette.secondary.main,.08)},colSpan:10+ +h+ +p,children:e.jsx(b,{sx:{display:"flex",alignItems:"center"},children:e.jsxs(i,{variant:"subtitle2",sx:{fontSize:"14px"},children:[t," - ",Re[t]]})})})}),!T[t]&&x[t].sort((n,U)=>v(u.fromISO(n.start),u.fromISO(U.start))).map(n=>e.jsx(oe,{appointment:n,showEstimated:h,showProvider:p,next:n.id===y&&w},n.id))]},t))})]})})]})}function is(){const{alignment:s,state:o,date:a,providers:l,groups:d,setAppointments:c}=X(I,["alignment","state","providers","groups","date","setAppointments"]),[j,f]=m.useState(C.ready),h=(v,y)=>{f(y)},p=ce(),{isFetching:x,isFetchedAfterMount:T}=De({apiClient:p,stateFilter:o||void 0,providersFilter:l||void 0,groupsFilter:d||void 0,patientFilter:s,statusesFilter:Pe[j],dateFilter:typeof a=="object"?a==null?void 0:a.toISODate():a},v=>{c(v.appointments)});return m.useEffect(()=>{I.setState({isAppointmentsLoading:!T})},[T]),e.jsx(b,{sx:{width:"100%",marginTop:3},children:e.jsxs(Le,{value:j,children:[e.jsx(b,{sx:{borderBottom:1,borderColor:"divider"},children:e.jsxs(Ee,{onChange:h,"aria-label":"appointment tabs",children:[e.jsx(q,{label:"Ready for provider",value:C.ready,sx:{textTransform:"none",fontWeight:700}}),e.jsx(q,{label:"Provider",value:C.provider,sx:{textTransform:"none",fontWeight:700}}),e.jsx(q,{label:"Unsigned",value:C["not-signed"],sx:{textTransform:"none",fontWeight:700}}),e.jsx(q,{label:"Complete",value:C.complete,sx:{textTransform:"none",fontWeight:700}}),x&&e.jsx(We,{})]})}),e.jsx($e,{sx:{marginTop:5},children:e.jsx(Ne,{value:j,sx:{padding:0},children:e.jsx(ts,{tab:j})})}),e.jsx(Ue,{visitService:"telemedicine"})]})})}const le=["(123) 456-7890","(123) 456-7850","example@ottehr.com"];function rs(){const{alignment:s,setAlignment:o}=X(I,["alignment","setAlignment"]),[a,l]=m.useState(le[0]),d=c=>{c.target.value&&l(c.target.value)};return e.jsx("form",{children:e.jsx(He,{children:e.jsxs(e.Fragment,{children:[e.jsxs(_e,{container:!0,direction:"row",justifyContent:"space-between",alignItems:"center",children:[e.jsxs(Ve,{size:"small",value:s,exclusive:!0,onChange:o,children:[e.jsx(ae,{value:"my-patients",children:"My Patients"}),e.jsx(ae,{value:"all-patients",children:"All Patients"})]}),e.jsx(b,{sx:{width:260},children:e.jsxs(Ge,{fullWidth:!0,variant:"standard",children:[e.jsx(qe,{id:"demo-simple-select-label",children:"Send alerts to:"}),e.jsxs(Qe,{labelId:"demo-simple-select-label",sx:{width:"260px"},value:a,label:"Send alerts to:",onChange:d,children:[le.map(c=>e.jsx(Ke,{value:c,children:c},c)),e.jsx(Xe,{size:"small",fullWidth:!0,sx:{padding:"6px 16px",justifyContent:"flex-start",fontSize:"14px",fontWeight:700,textTransform:"none"},children:"Manage contacts"})]})]})})]}),e.jsx(is,{})]})})})}function as(){const s=de();return m.useEffect(()=>{const o=(s==null?void 0:s.profileResource)&&Ze(s.profileResource).map(a=>a.state);o&&I.setState({availableStates:o})},[s]),e.jsx(rs,{})}export{as as TrackingBoardPage};
