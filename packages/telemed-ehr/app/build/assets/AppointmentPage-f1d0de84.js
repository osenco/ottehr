import{j as e,ab as V,ac as z,ad as q,T as B,ae as W,a9 as T,af as y,ag as S,ah as F,ai as Se,r as o,aj as H,a5 as te,a6 as ae,a7 as ne,a8 as se,u as G,l as Ce,m as Ie,f as $,ak as k,al as le,am as ce,an as be,B as d,ao as D,p as De,ap as Pe,a as _e,aq as L,ar as Re,as as we,at as ie,au as Me,av as Oe,aw as re,ax as Ae,ay as de,az as ue,aA as ke,aB as Ve,aC as Le,aD as Te,aE as $e,aF as Ee,aG as He,aH as ze,aI as qe,aJ as Be,aK as We,aL as Fe,aM as Ge,aN as Ne,aO as oe}from"./index-b40a3c2f.js";const Ke=({onClose:t,preferredLanguage:a,isOpen:s})=>{const i=a,l={fontWeight:"700",textTransform:"none",borderRadius:6,mb:2,ml:1};return e.jsxs(V,{open:s,onClose:t,fullWidth:!0,disableScrollLock:!0,sx:{".MuiPaper-root":{padding:1,width:"444px",maxWidth:"initial"}},children:[e.jsx(z,{variant:"h4",color:"primary.dark",sx:{width:"100%"},children:"Patientâ€™s Preferred Language"}),e.jsx(q,{children:e.jsxs(B,{children:[e.jsx("strong",{children:i})," is the preferred language for the patient. Please contact the language line if the patient needs an interpreter:",e.jsx("br",{}),"(123) 456-7890.",e.jsx("br",{}),"This number is always available in the bottom left corner of the screen."]})}),e.jsx(W,{sx:{justifyContent:"flex-end",mr:3},children:e.jsx(T,{onClick:t,color:"primary",variant:"contained",size:"medium",sx:l,children:"OK, Got it"})})]})},Qe=({onClose:t,isOpen:a})=>{const s={fontWeight:"700",textTransform:"none",borderRadius:6,mb:2,ml:1};return e.jsxs(V,{open:a,onClose:t,fullWidth:!0,disableScrollLock:!0,sx:{".MuiPaper-root":{padding:1,width:"444px",maxWidth:"initial"}},children:[e.jsx(z,{variant:"h4",color:"primary.dark",sx:{width:"100%"},children:"Patient requires a Hearing Impaired Relay Service (711)"}),e.jsx(q,{children:e.jsx(B,{children:"Patient requires a Hearing Impaired Relay Service (711). Patient number is (123) 456-7890."})}),e.jsx(W,{sx:{justifyContent:"flex-end",mr:3},children:e.jsx(T,{onClick:t,color:"primary",variant:"contained",size:"medium",sx:s,children:"OK, Got it"})})]})};var N={},Ue=S;Object.defineProperty(N,"__esModule",{value:!0});var pe=N.default=void 0,Xe=Ue(y()),Je=e;pe=N.default=(0,Xe.default)((0,Je.jsx)("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9"}),"CallEnd");var K={},Ye=S;Object.defineProperty(K,"__esModule",{value:!0});var xe=K.default=void 0,Ze=Ye(y()),et=e;xe=K.default=(0,Ze.default)((0,et.jsx)("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic");var Q={},tt=S;Object.defineProperty(Q,"__esModule",{value:!0});var he=Q.default=void 0,at=tt(y()),nt=e;he=Q.default=(0,at.default)((0,nt.jsx)("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff");var U={},st=S;Object.defineProperty(U,"__esModule",{value:!0});var fe=U.default=void 0,it=st(y()),rt=e;fe=U.default=(0,it.default)((0,rt.jsx)("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings");var X={},ot=S;Object.defineProperty(X,"__esModule",{value:!0});var ve=X.default=void 0,lt=ot(y()),ct=e;ve=X.default=(0,lt.default)((0,ct.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");var J={},dt=S;Object.defineProperty(J,"__esModule",{value:!0});var ge=J.default=void 0,ut=dt(y()),pt=e;ge=J.default=(0,ut.default)((0,pt.jsx)("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff");const xt=({onClose:t,open:a})=>{const s=F(),i=Se(),[l,p]=o.useState([]),[m,f]=o.useState([]),[x,c]=o.useState(""),[v,P]=o.useState(""),j=o.useRef(null),C=o.useMemo(()=>{const n=new H.ConsoleLogger("preview");return new H.DefaultDeviceController(n)},[]),w=async()=>{x&&await(i==null?void 0:i.startVideoInput(x)),v&&await(i==null?void 0:i.startAudioInput(v)),t()};o.useEffect(()=>{var M;const n={audioInputsChanged:h=>{f(h)},videoInputsChanged:h=>{p(h)}};return(M=s.audioVideo)==null||M.addDeviceChangeObserver(n),(async()=>{var O,u,b,A;const h=(u=await((O=s.audioVideo)==null?void 0:O.listVideoInputDevices()))!=null?u:[],R=(A=await((b=s.audioVideo)==null?void 0:b.listAudioInputDevices()))!=null?A:[];p(h),f(R),h.length>0&&c(h[0].deviceId),R.length>0&&P(R[0].deviceId)})(),()=>{var h;(h=s.audioVideo)==null||h.removeDeviceChangeObserver(n)}},[s.audioVideo]);const I=o.useCallback(async n=>{C&&j.current&&(await C.startVideoInput(n),C.startVideoPreviewForVideoInput(j.current))},[C]),_=async n=>{const g=n.target.value;c(g),await I(g)},r=async n=>{const g=n.target.value;P(g),await(i==null?void 0:i.startAudioInput(g))};return o.useEffect(()=>{let n=!1;return a&&x&&setTimeout(()=>{n||I(x)},200),()=>{n=!0}},[a,x,I]),e.jsxs(V,{open:a,onClose:t,children:[e.jsx(z,{children:"Call Settings"}),e.jsxs(q,{children:[e.jsx("video",{ref:j,autoPlay:!0,muted:!0,playsInline:!0,style:{height:"100%",width:"100%"}}),e.jsxs(te,{fullWidth:!0,margin:"normal",children:[e.jsx(ae,{children:"Camera"}),e.jsx(ne,{value:x,onChange:_,label:"Camera",children:l.map(n=>e.jsx(se,{value:n.deviceId,children:n.label},n.deviceId))})]}),e.jsxs(te,{fullWidth:!0,margin:"normal",children:[e.jsx(ae,{children:"Microphone"}),e.jsx(ne,{value:v,onChange:r,label:"Microphone",children:m.map(n=>e.jsx(se,{value:n.deviceId,children:n.label},n.deviceId))})]})]}),e.jsxs(W,{sx:{alignItems:"center",justifyContent:"flex-end",padding:"16px 24px"},children:[e.jsx(T,{onClick:t,sx:{marginRight:1},variant:"text",children:"Cancel"}),e.jsx(T,{onClick:w,variant:"contained",children:"Save Changes"})]})]})},ht=()=>{const t=G(),a=Ce(),{mutateAsync:s,isLoading:i}=Ie(),{encounter:l}=$(k,["encounter"]),{id:p}=le(),{toggleVideo:m,isVideoEnabled:f}=ce(),{muted:x,toggleMute:c}=be(),v=F(),[P,j]=o.useState(!1),C=()=>{j(!0)},w=()=>{j(!1)},I=async()=>{var r;v&&(await((r=v.meetingSession)==null?void 0:r.deviceController.destroy().catch(n=>console.error(n))),await v.leave().catch(n=>console.error(n))),L.setState({meetingData:null})},_=async()=>{a&&p&&(await s({apiClient:a,appointmentId:p,newStatus:_e.unsigned},{}),k.setState({encounter:{...l,status:"finished"}})),await I()};return e.jsxs(e.Fragment,{children:[e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2,py:1},children:[e.jsx(D,{onClick:m,variant:f?void 0:"disabled",children:f?e.jsx(ve,{sx:{color:t.palette.primary.contrastText}}):e.jsx(ge,{sx:{color:t.palette.primary.dark}})}),e.jsx(D,{onClick:c,variant:x?"disabled":void 0,children:x?e.jsx(he,{sx:{color:t.palette.primary.dark}}):e.jsx(xe,{sx:{color:t.palette.primary.contrastText}})}),e.jsx(D,{onClick:C,children:e.jsx(fe,{sx:{color:t.palette.primary.contrastText}})}),e.jsx(De,{title:"Do you want to end video call with the patient?",response:_,actionButtons:{proceed:{text:"End video call",color:"error"},back:{text:"Cancel"}},children:r=>e.jsx(D,{onClick:r,disabled:i,variant:"error",children:i?e.jsx(Pe,{size:24,sx:{color:t.palette.primary.contrastText}}):e.jsx(pe,{sx:{color:t.palette.primary.contrastText}})})})]}),e.jsx(xt,{onClose:w,open:P})]})},ft=()=>{var x;const t=G(),{attendeeIdToTileId:a}=Re(),{isVideoEnabled:s}=ce(),{roster:i}=we(),l=$(L,["meetingData"]),[p,m]=o.useState(null),f=o.useMemo(()=>Object.keys(i).filter(c=>{var v;return((v=l.meetingData)==null?void 0:v.Attendee).AttendeeId!==c}).map(c=>({...i[c],tileId:a[c]})),[i,(x=l.meetingData)==null?void 0:x.Attendee,a]);return o.useEffect(()=>{f.length?m(f[0]):m(null)},[f]),e.jsx(d,{sx:{display:"flex",flexDirection:"column",flex:1,height:"100%"},children:e.jsxs(d,{sx:{display:"flex",flexDirection:"column",height:"100%"},children:[e.jsxs(d,{sx:{display:"flex",padding:1,gap:1,height:"100%"},children:[e.jsx(d,{sx:{color:"white",width:"100%",overflow:"hidden",display:"flex",gap:1},children:p&&e.jsx(d,{sx:{height:"100%",overflow:"hidden",position:"relative",width:"100%",backgroundColor:t.palette.primary.dark,borderRadius:2},children:p.tileId&&e.jsx(ie,{tileId:p.tileId})})}),e.jsxs(d,{sx:{color:"white",minWidth:"20%",display:"grid",gridAutoColumns:"1fr",rowGap:1,alignContent:"start"},children:[e.jsxs(d,{sx:{aspectRatio:"1/1",backgroundColor:t.palette.primary.dark,borderRadius:"8px",overflow:"hidden",position:"relative"},children:[s&&e.jsx(Me,{}),e.jsx(d,{sx:{position:"absolute",top:0,left:0,height:34,width:"100%",backgroundImage:"linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0))",pt:"10px",pl:"10px"},children:e.jsx(B,{sx:{fontWeight:700,fontSize:"14px"},children:"You"})})]}),f.filter(c=>c.chimeAttendeeId!==(p==null?void 0:p.chimeAttendeeId)).map(c=>e.jsx(d,{sx:{aspectRatio:"1/1",backgroundColor:t.palette.primary.dark,borderRadius:"8px",overflow:"hidden",position:"relative",cursor:c.tileId?"pointer":"auto"},children:c.tileId&&e.jsx(ie,{onClick:()=>{m(c)},tileId:c.tileId})},c.chimeAttendeeId))]})]}),e.jsx(d,{sx:{backgroundColor:t.palette.primary.dark,display:"flex",justifyContent:"end",px:1},children:e.jsx(ht,{})})]})})};var Y={},vt=S;Object.defineProperty(Y,"__esModule",{value:!0});var me=Y.default=void 0,gt=vt(y()),mt=e;me=Y.default=(0,gt.default)((0,mt.jsx)("path",{d:"M19 7h-8v6h8zm2-4H3c-1.1 0-2 .9-2 2v14c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98V5c0-1.1-.9-2-2-2m0 16.01H3V4.98h18z"}),"PictureInPicture");var Z={},jt=S;Object.defineProperty(Z,"__esModule",{value:!0});var je=Z.default=void 0,yt=jt(y()),St=e;je=Z.default=(0,yt.default)((0,St.jsx)("path",{fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3"}),"PushPin");var ee={},Ct=S;Object.defineProperty(ee,"__esModule",{value:!0});var ye=ee.default=void 0,It=Ct(y()),bt=e;ye=ee.default=(0,It.default)((0,bt.jsx)("path",{d:"M21 11V3h-8l3.29 3.29-10 10L3 13v8h8l-3.29-3.29 10-10z"}),"OpenInFull");const Dt=({children:t})=>{const[a,s]=o.useState("pip"),i=o.useRef(null);return console.log(window.innerHeight),a==="pip"?e.jsxs(e.Fragment,{children:[e.jsx(V,{open:!0,hideBackdrop:!0,disableEnforceFocus:!0,disableScrollLock:!0,style:{pointerEvents:"none"},PaperProps:{style:{pointerEvents:"auto"}},PaperComponent:l=>e.jsx(Oe,{nodeRef:i,handle:".handle",bounds:"parent",defaultPosition:{x:0,y:350+24-window.innerHeight/2},children:e.jsx(re,{ref:i,...l,sx:{borderRadius:2,height:"400px",width:"500px"}})}),children:e.jsx(E,{type:a,setType:s,children:t})}),e.jsx(d,{sx:{height:"424px"}})]}):a==="fullscreen"?e.jsxs(V,{fullScreen:!0,open:!0,children:[e.jsx(d,{sx:{display:"flex",flex:1},children:e.jsx(E,{type:a,setType:s,children:t})}),e.jsx(Ae,{}),e.jsx(de,{})]}):e.jsx(ue,{maxWidth:"sm",sx:{mt:3},children:e.jsx(re,{elevation:0,sx:{borderRadius:2},children:e.jsx(E,{type:a,setType:s,children:e.jsx(d,{sx:{height:"400px"},children:t})})})})},E=t=>{const{type:a,setType:s,children:i}=t,l=G();return e.jsxs(d,{sx:{backgroundColor:l.palette.primary.dark,color:"white",display:"flex",flexDirection:"column",flex:1},children:[e.jsxs(d,{sx:{p:1,display:"flex",gap:1,cursor:a==="pip"?"move":"default"},className:"handle",children:[e.jsx(D,{size:"small",variant:a==="pip"?"disabled":void 0,onClick:()=>s("pip"),sx:{color:a==="pip"?l.palette.primary.dark:l.palette.primary.contrastText},children:e.jsx(me,{fontSize:"small"})}),e.jsx(D,{size:"small",variant:a==="pinned"?"disabled":void 0,onClick:()=>s("pinned"),sx:{color:a==="pinned"?l.palette.primary.dark:l.palette.primary.contrastText},children:e.jsx(je,{fontSize:"small"})}),e.jsx(D,{size:"small",variant:a==="fullscreen"?"disabled":void 0,onClick:()=>s("fullscreen"),sx:{color:a==="fullscreen"?l.palette.primary.dark:l.palette.primary.contrastText},children:e.jsx(ye,{fontSize:"small"})})]}),e.jsx(d,{sx:{backgroundColor:"#1A093B",height:"100%"},children:i})]})},Pt=()=>{const t=$(L,["meetingData"]),a=F();return o.useEffect(()=>{let s=!1;return(async()=>{if(t.meetingData){const l=new H.MeetingSessionConfiguration(t.meetingData.Meeting,t.meetingData.Attendee),p={deviceLabels:ke.AudioAndVideo};if(await a.join(l,p),s)return;await a.start()}})(),()=>{s=!0}},[a,t.meetingData]),e.jsx(Dt,{children:e.jsx(ft,{})})},Rt=()=>{const{id:t}=le(),{meetingData:a}=$(L,["meetingData"]);Ve();const[s,i]=o.useState(!1),[l,p]=o.useState(!1),[m,f]=o.useState(!1),[x,c]=o.useState(!1),[v,P]=o.useState(void 0),j=x&&!m,C=l&&!s&&!j,w=()=>{i(!0)},I=()=>{f(!0)},{isFetching:_}=Le({appointmentId:t},r=>{var h,R,O;const n=r==null?void 0:r.find(u=>u.resourceType==="QuestionnaireResponse");k.setState({appointment:r==null?void 0:r.find(u=>u.resourceType==="Appointment"),patient:r==null?void 0:r.find(u=>u.resourceType==="Patient"),location:r==null?void 0:r.find(u=>u.resourceType==="Location"),encounter:r==null?void 0:r.find(u=>u.resourceType==="Encounter"),questionnaireResponse:n,patientPhotoUrls:(r==null?void 0:r.filter(u=>{var b,A;return u.resourceType==="DocumentReference"&&u.status==="current"&&((A=(b=u.type)==null?void 0:b.coding)==null?void 0:A[0].code)===Ne}).flatMap(u=>u.content.map(b=>b.attachment.url)).filter(Boolean))||[]});const g=(R=(h=oe("relay-phone",n))==null?void 0:h.answer.find(Boolean))==null?void 0:R.valueString;(g==null?void 0:g.toLowerCase())==="yes"&&p(!0);const M=(O=oe("preferred-language",n))==null?void 0:O.answer[0].valueString;P(M),M!=="English"&&c(!0)});return o.useEffect(()=>{k.setState({appointment:void 0,patient:void 0,location:void 0,encounter:{},questionnaireResponse:void 0,patientPhotoUrls:[],chartData:void 0,currentTab:"hpi"}),Te.setState($e),L.setState({meetingData:null}),Ee.setState(He)},[]),o.useEffect(()=>{k.setState({isAppointmentLoading:_})},[_]),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100vh"},children:[e.jsx(ze,{}),e.jsx(Ke,{isOpen:j,onClose:I,preferredLanguage:v}),e.jsx(Qe,{isOpen:C,onClose:w}),e.jsxs(d,{sx:{display:"flex",flexDirection:"column",alignItems:"center",flex:1,width:"100%"},children:[a&&e.jsxs(qe,{theme:Be,children:[e.jsx(We,{}),e.jsx(Fe,{children:e.jsx(Pt,{})})]}),e.jsx(ue,{maxWidth:"xl",sx:{my:3},children:e.jsx(Ge,{})})]}),e.jsx(de,{})]})};export{Rt as AppointmentPage};
